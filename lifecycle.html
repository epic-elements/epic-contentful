<link rel="import" href="../epic-rx/epic-rx.html">
<script>

    window.Epic = window.Epic || {Behaviors:{}};

    class EpicObservable extends Rx.Observable {
        static fromPropertyChanges(properties, element) {
            let propertyStream = this.from(Object.keys(properties));
            return propertyStream.filter(x=>element).map(x=>{
                return element[x];
            }).merge(this.merge(propertyStream.flatMap(x=>this.fromEvent(element, `${x}-changed`))));
        }
    }

    class EpicLifecycle {
        // Define other lifecycle methods as you need.
        static registered() {


            let propertyObservableConfig = Epic.Observable.from(this.observables);

            this.propertyChanges = new Rx.BehaviorSubject();

            propertyObservableConfig.subscribe(x=>{
                this[`${x}Changed`] = (i)=>{
                    this.propertyChanges.onNext({property: x, value: i});
                };
            });

            let observerNames = propertyObservableConfig.map(x=>`${x}Changed(${x})`).reduce((x,y)=>{
                x.push(y);
                return x;
            },new Array())
            .subscribe(x=>this.observers = x);



            this.propertyChanges.subscribe(x=>console.log(x));
            // this.observables.subscribe(x=>console.log(x));
        // this.Observable = EpicObservable;
     }

        static created() {
            this.propertyChanges.onNext({property: 1, value: 2});
            console.log('created');
            // this.propertyChanges = Epic.Observable.fromPropertyChangedEvents(this.properties);

            // this.propertyChanges = Epic.Observable.fromPropertyChangedEvents(this.properties, this);

        }
        static ready() { console.log('ready');}
        static attached() { console.log('attached');}
        static detached() {console.log('detached'); }
        static attributeChanged() { console.log('attributeChanged');}


    };
    window.Epic.Behaviors.Lifecycle = EpicLifecycle;
    window.Epic.Observable = EpicObservable;
</script>
